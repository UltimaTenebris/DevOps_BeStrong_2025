name: $(Date:yyyyMMdd)$(Rev:.r)

trigger:
  branches:
    include:
      - main

pool:
  name: 'Default'

steps:
# 1. Install Terraform
- task: TerraformInstaller@0
  displayName: 'Install Terraform'
  inputs:
    terraformVersion: '1.5.0'

# 2. Init (Local Backend)
# We don't provide backend-config because we commented it out in main.tf
- script: |
    echo "Initializing Terraform locally..."
    terraform init
  displayName: 'Terraform Init'

# 3. Validate (Syntax Check)
# This checks for missing brackets, typos, etc.
- script: |
    echo "Validating configuration..."
    terraform validate
  displayName: 'Terraform Validate'

# 4. Format Check (Style Check)
# This checks if your code is ugly (bad indentation). 
# Professionals use this to keep code clean.
- script: |
    echo "Checking code formatting..."
    terraform fmt -check -recursive
  displayName: 'Check Formatting'
